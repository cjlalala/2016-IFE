var operId,operIds=[];var operType;var _quesNaire;$(document).ready(function(){initHandle.initData();listHandle.localStory();initHandle.showList()});var initHandle={initData:function(){if(localStorage._quesNaire!=null){_quesNaire=JSON.parse(window.localStorage.getItem("_quesNaire"))}else{_quesNaire=DataQ}},showList:function(){var strTbody=[];if(_quesNaire.length==0){$("#new_list").css("display","block");$("#btnNew").css("visibility","hidden");$("#table_list").css("display","none");return}for(var item in _quesNaire){strTbody.push("<tr><td><input type='checkbox' class='selectMem' value='"+_quesNaire[item].id+"'></td><td>"+_quesNaire[item].name+"</td><td>"+_quesNaire[item].timePub+"</td>");if(_quesNaire[item].state=="未发布"){strTbody.push("<td class='loading'>"+_quesNaire[item].state+"</td><td><a href='edit.html#"+_quesNaire[item].id+"'><button>编辑</button></a><button class='deleteThis' value='"+_quesNaire[item].id+"'>删除</button><button class='upDateThis' value='"+_quesNaire[item].id+"'>发布</button></td></tr>")}else{strTbody.push("<td>"+_quesNaire[item].state+"</td><td><a  href='look.html#"+_quesNaire[item].id+"'><button>查看问卷</button></a><a href='check.html#"+_quesNaire[item].id+"'><button>查看数据</button></a></td></tr>")}}$("#tBody").html(strTbody.join(""))}};$("#table").bind("click",function(event){event=event||window.event;var target=event.target||event.srcElement;var checkedDel=$(".selectMem:checked");switch(target.className){case"selectAll":$(".selectMem").prop("checked",target.checked);break;case"selectMem":if(target.checked){if(checkedDel.length==$(".selectMem").length){$("#selectAll").prop("checked",true)}}else{$("#selectAll").prop("checked",false)}break;case"upDateThis":maskHandle.showMask("确认要发布此问卷？");operType="update";operId=target.value;break;case"deleteList":if(checkedDel.length==0){alert("请勾选要删除的问卷！");return}maskHandle.showMask("确认要删除所有勾选的问卷？");operType="deletes";operIds=[];for(var i=0;i<checkedDel.length;i++){operIds.push(checkedDel[i].value)}break;case"deleteThis":maskHandle.showMask("确认要删除此问卷？");operType="delete";operId=target.value;break}});$("#parent").bind("click",function(event){event=event||window.event;var target=event.target||event.srcElement;event.preventDefault();switch(target.id){case"yes":maskHandle.hideMask();if(operType=="delete"){listHandle.deleteD()}if(operType=="update"){listHandle.update()}if(operType=="deletes"){listHandle.deletes()}initHandle.showList();break;case"no":case"cover":case"close":maskHandle.hideMask();break}});var listHandle={deleteD:function(){for(var item in _quesNaire){if(_quesNaire[item].id==operId){_quesNaire.splice(item,1);break}}listHandle.localStory()},update:function(){for(var item in _quesNaire){if(_quesNaire[item].id==operId){_quesNaire[item].state="已发布";break}}listHandle.localStory()},deletes:function(){for(var i=operIds.length-1;i>=0;i--){for(var j=_quesNaire.length-1;j>=0;j--){if(operIds[i]==_quesNaire[j].id){_quesNaire.splice(j,1);break}}}listHandle.localStory()},localStory:function(){window.localStorage.setItem("_quesNaire",JSON.stringify(_quesNaire))},};var maskHandle={showMask:function(str){$("#alertCont").append(str);$("#cover").css("display","block");$("#deleteCover").css("display","block")},hideMask:function(){$("#alertCont").empty();$("#cover").css("display","none");$("#deleteCover").css("display","none")}};
